@using Blazix.RovingFocusGroup
@using System.Diagnostics.CodeAnalysis

<RovingFocusGroupRoot @ref="rovingFocusGroup"
                      Orientation="Context!.Orientation"
                      ReadingDirection="Context.ReadingDirection"
                      Loop="Loop"
                      CurrentTabStopId="@Context.Value">
    <div role="tablist"
         aria-orientation="@Context.Orientation.ToDataAttributeString()"
         tabindex="@(Loop? rovingFocusGroup?.TabIndex : null)"
         data-orientation="@Context.Orientation.ToDataAttributeString()"
         @attributes="AdditionalAttributes"
         style="@CombineStyles(AdditionalAttributes, Loop ? rovingFocusGroup?.Style : null)"
         @ref="Element">
        @ChildContent
    </div>
</RovingFocusGroupRoot>

@code {
    private RovingFocusGroupRoot? rovingFocusGroup;

    [CascadingParameter]
    private TabsContext? Context { get; set; }

    /// <summary>
    /// Determines whether focus should loop from the tab to first item and vice versa.
    /// <para>Defaults to <see langword="true"/>.</para>
    /// </summary>
    [Parameter]
    public bool Loop { get; set; } = true;

    /// <summary>
    /// Defines the child components of this instance.
    /// </summary>
    [Parameter]
    public RenderFragment? ChildContent { get; set; }

    /// <summary>
    /// Gets or sets a collection of additional attributes that will be applied to the created element.
    /// </summary>
    [Parameter(CaptureUnmatchedValues = true)]
    public IReadOnlyDictionary<string, object>? AdditionalAttributes { get; set; }

    /// <summary>
    /// Gets or sets the associated <see cref="ElementReference"/>.
    /// <para>
    /// May be <see langword="null"/> if accessed before the component is rendered.
    /// </para>
    /// </summary>
    [DisallowNull]
    public ElementReference? Element { get; protected set; }

    /// <inheritdoc />
    protected override void OnParametersSet()
    {
        if (Context is null)
        {
            throw new InvalidOperationException($"'{nameof(TabsList)}' must have an ancestor '{nameof(TabsRoot)}' that provides a '{nameof(TabsContext)}'.");
        }
    }
}
